:root{
  --bg: #0b0b10;
  --paper: #f7f7fb;
  --pink: #ff4fb8;
  --pink2:#ff7bd1;
  --warm:#ffd7b0;
  --shadow: 0 20px 50px rgba(0,0,0,.35);
  --softShadow: 0 14px 30px rgba(0,0,0,.28);
}

*{ box-sizing:border-box; }
html,body{ height:100%; }
body{
  margin:0;
  font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Apple Color Emoji","Segoe UI Emoji";
  background: radial-gradient(1200px 700px at 50% 0%, #191926 0%, var(--bg) 55%, #05050a 100%);
  color: var(--paper);
  overflow-x:hidden;
}

button, .ctrl-btn { -webkit-tap-highlight-color: transparent; }
.app{ min-height:100%; }

.screen{
  min-height:100vh;
  display:none;
  position:relative;
  padding: env(safe-area-inset-top) 16px env(safe-area-inset-bottom) 16px;
}
.screen--active{ display:block; }

.screen.fade-out{ animation: fadeOut .55s ease forwards; }
.screen.fade-in{ animation: fadeIn .55s ease forwards; }
@keyframes fadeOut{ to{ opacity:0; transform: translateY(8px); } }
@keyframes fadeIn{ from{ opacity:0; transform: translateY(8px); } to{ opacity:1; transform: translateY(0); } }

/* TOP BAR */
.topbar{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:10px;
  padding:14px 8px 10px;
}
.brand{ display:flex; align-items:center; gap:10px; opacity:.95; }
.brand__dot{
  width:12px; height:12px; border-radius:999px;
  background: radial-gradient(circle at 30% 30%, #fff 0%, #ff7bd1 40%, #ff4fb8 75%);
  box-shadow: 0 0 18px rgba(255,79,184,.35);
}
.brand__title{ font-weight:650; letter-spacing:.3px; }

.btn{
  border:0;
  padding:10px 12px;
  border-radius:14px;
  cursor:pointer;
  transition: transform .12s ease, filter .12s ease, background .12s ease;
  font-weight:650;
}
.btn:active{ transform: scale(.98); }

.btn--ghost{
  background: rgba(255,255,255,.08);
  color: var(--paper);
  border: 1px solid rgba(255,255,255,.14);
  box-shadow: 0 10px 18px rgba(0,0,0,.22);
}
.btn--ghost:hover{ filter: brightness(1.05); }

.btn--primary{
  background: linear-gradient(135deg, var(--pink), var(--pink2));
  color: #12121a;
  box-shadow: 0 16px 26px rgba(255,79,184,.25);
}
.btn--primary:hover{ filter: brightness(1.05); }

/* MAZE WRAP */
.maze-wrap{ display:flex; justify-content:center; padding: 10px 0 110px; }
.house-frame{ width:min(980px, 96vw); filter: drop-shadow(0 22px 44px rgba(0,0,0,.45)); }

.house-frame__inner{
  position:relative;
  width:100%;
  border-radius:22px;
  padding: 18px;
  background:
    radial-gradient(800px 450px at 50% 0%, rgba(255,255,255,.12), transparent 55%),
    rgba(255,255,255,.04);
  border: 1px solid rgba(255,255,255,.10);
  box-shadow: var(--shadow);
  overflow:hidden;
}
.house-frame__inner:after{
  content:"";
  position:absolute; inset:0;
  background-image: radial-gradient(rgba(255,255,255,.08) 1px, transparent 1px);
  background-size: 22px 22px;
  opacity:.06;
  pointer-events:none;
}

/* HUD BAR is now in normal flow above the canvas */
.maze-hudbar{
  display:flex;
  flex-wrap:wrap;
  gap:10px;
  align-items:center;
  justify-content:flex-start;
  margin-bottom: 12px;
}
.hud__pill{
  background: rgba(0,0,0,.82);
  color:#fff;
  border: 1px solid rgba(0,0,0,.9);
  padding:8px 10px;
  border-radius: 999px;
  font-weight:650;
  font-size: 13px;
  width: fit-content;
}
.hud__pill--subtle{ opacity:.9; font-weight:650; }

/* Canvas wrapper so toast/sparkles overlay ONLY the canvas area */
.maze-canvas-wrap{
  position:relative;
}
#mazeCanvas{
  width:100%;
  height:auto;
  display:block;
  background:#fff;
  border-radius:18px;
  border: 8px solid #000;
}

/* Start/Exit moved below canvas */
.maze-footer{
  margin-top: 12px;
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:12px;
}

.label{
  font-weight:900;
  letter-spacing:.7px;
  color:#000;
  text-transform:uppercase;
  font-size: clamp(12px, 2.6vw, 16px);
  background: rgba(255,255,255,.82);
  border: 2px solid #000;
  border-radius: 14px;
  padding: 6px 10px;
  user-select:none;
}
.label--start{ transform: rotate(-1deg); }
.label--exit{ transform: rotate(1deg); }

.label.locked{ opacity:.7; filter: grayscale(.2); }
.label.unlocked{
  box-shadow: 0 0 18px rgba(255,79,184,.25);
  border-color: rgba(0,0,0,.9);
}

/* Toast over canvas only */
.toast{
  position:absolute;
  top: 10px;
  left: 10px;
  background: rgba(255,255,255,.92);
  color:#0d0d12;
  border: 1px solid rgba(0,0,0,.18);
  border-radius: 14px;
  padding: 8px 10px;
  font-weight: 800;
  font-size: 12px;
  opacity:0;
  transform: translateY(-6px);
  transition: opacity .25s ease, transform .25s ease;
  pointer-events:none;
  z-index:5;
}
.toast.show{ opacity:1; transform: translateY(0); }

/* Sparkles over canvas only */
.sparkle-burst{ position:absolute; inset:0; pointer-events:none; opacity:0; z-index:4; }
.sparkle-burst.show{ opacity:1; }
.sparkle{
  position:absolute;
  width:8px; height:8px;
  border-radius:999px;
  background:#fff;
  filter: drop-shadow(0 0 10px rgba(255,79,184,.55));
  animation: sparklePop .7s ease-out forwards;
}
@keyframes sparklePop{
  from{ transform: translate(0,0) scale(.9); opacity:1; }
  to{ transform: translate(var(--dx), var(--dy)) scale(0); opacity:0; }
}

/* CONTROLLER: true D-pad grid so UP is centered */
.controller{
  position:fixed;
  left:50%;
  bottom: calc(14px + env(safe-area-inset-bottom));
  transform: translateX(-50%);
  z-index:20;
  user-select:none;
}

.dpad{
  display:grid;
  grid-template-columns: 56px 70px 56px;
  grid-template-rows: 50px 54px;
  grid-template-areas:
    ". up ."
    "left down right";
  gap: 12px;
  align-items:center;
  justify-items:center;
}

.ctrl-btn{
  width: 56px;
  height: 50px;
  border-radius: 16px;
  border: 1px solid rgba(255,255,255,.18);
  background: rgba(255,255,255,.14);
  color: #fff;
  font-size: 18px;
  font-weight:900;
  cursor:pointer;
  backdrop-filter: blur(10px);
  box-shadow: 0 14px 26px rgba(0,0,0,.25);
  transition: transform .12s ease, filter .12s ease;
}
.ctrl-btn--big{
  width: 70px;
  height: 54px;
  border-radius: 18px;
  background: rgba(255,79,184,.22);
  border: 1px solid rgba(255,79,184,.38);
}
.ctrl-btn:active{ transform: scale(.96); }
.ctrl-btn:hover{ filter: brightness(1.07); }

.ctrl-btn--up{ grid-area: up; }
.ctrl-btn--left{ grid-area: left; }
.ctrl-btn--down{ grid-area: down; }
.ctrl-btn--right{ grid-area: right; }

/* Footer note */
.footer-note{
  position:fixed;
  left:50%;
  bottom: calc(96px + env(safe-area-inset-bottom));
  transform: translateX(-50%);
  font-size: 12px;
  opacity:.7;
  pointer-events:none;
}

/* HOUSE SCREEN */
#screen-house{
  background:
    radial-gradient(1000px 600px at 50% 0%, rgba(255,79,184,.20), transparent 55%),
    radial-gradient(900px 650px at 30% 20%, rgba(255,215,176,.18), transparent 55%),
    linear-gradient(180deg, #140b18 0%, #07060b 70%, #05050a 100%);
  overflow:hidden;
}

.house-scene{
  min-height:100vh;
  display:flex;
  align-items:center;
  justify-content:center;
  padding: 30px 0;
  position:relative;
}
.house-scene__glow{
  position:absolute;
  width: 680px; height: 680px;
  border-radius: 50%;
  background: radial-gradient(circle at 50% 40%, rgba(255,79,184,.20), transparent 60%);
  filter: blur(6px);
  opacity:.85;
  animation: glowPulse 3.2s ease-in-out infinite;
  pointer-events:none;
}
@keyframes glowPulse{
  0%,100%{ transform: scale(1); opacity:.8; }
  50%{ transform: scale(1.05); opacity:1; }
}

.house-card{
  position:relative;
  width:min(820px, 94vw);
  padding: 26px 18px 18px;
  border-radius: 26px;
  background: rgba(255,255,255,.06);
  border: 1px solid rgba(255,255,255,.12);
  box-shadow: var(--shadow);
  backdrop-filter: blur(10px);
  text-align:center;
  z-index:2;
}

.house-title{
  margin: 8px 0 6px;
  font-size: clamp(30px, 5vw, 44px);
  letter-spacing:.6px;
  text-shadow: 0 0 22px rgba(255,79,184,.25);
}
.house-subtitle{ margin: 0 0 18px; opacity:.85; }

.house-illustration{
  margin: 0 auto 14px;
  width: min(340px, 70vw);
  height: 220px;
  position:relative;
  filter: drop-shadow(0 14px 26px rgba(0,0,0,.35));
}
.roof{
  position:absolute; left: 50%; top: 42px;
  width: 220px; height: 90px;
  transform: translateX(-50%) skewX(-6deg);
  background: rgba(255,255,255,.10);
  border: 1px solid rgba(255,255,255,.18);
  border-radius: 16px 16px 10px 10px;
}
.house-body{
  position:absolute; left:50%; top: 95px;
  width: 260px; height: 120px;
  transform: translateX(-50%);
  background: rgba(255,255,255,.08);
  border: 1px solid rgba(255,255,255,.16);
  border-radius: 20px;
}
.chimney{
  position:absolute; left: calc(50% + 110px); top: 30px;
  width: 42px; height: 70px;
  background: rgba(255,255,255,.08);
  border: 1px solid rgba(255,255,255,.16);
  border-radius: 14px;
  transform: rotate(6deg);
}
.window{
  position:absolute; top: 30px;
  width: 46px; height: 46px;
  border-radius: 12px;
  background: radial-gradient(circle at 50% 35%, rgba(255,215,176,.35), rgba(255,215,176,.08));
  border: 1px solid rgba(255,215,176,.22);
  box-shadow: 0 0 20px rgba(255,215,176,.12);
}
.w1{ left: 46px; } .w2{ right: 46px; }
.door{
  position:absolute; left:50%; bottom: 10px;
  width: 62px; height: 78px;
  transform: translateX(-50%);
  border-radius: 16px;
  background: rgba(255,79,184,.15);
  border: 1px solid rgba(255,79,184,.25);
  box-shadow: 0 0 22px rgba(255,79,184,.15);
}
.moon{
  position:absolute; right: 6px; top: 6px;
  width: 64px; height: 64px;
  border-radius: 50%;
  background: radial-gradient(circle at 35% 35%, rgba(255,255,255,.35), rgba(255,255,255,.06));
  border: 1px solid rgba(255,255,255,.14);
}

/* hearts bg */
.hearts{ position:absolute; inset:0; pointer-events:none; overflow:hidden; opacity:.9; z-index:1; }
.heart{
  position:absolute;
  font-size: 16px;
  opacity:.0;
  animation: floatUp linear forwards;
  filter: drop-shadow(0 0 10px rgba(255,79,184,.25));
}
@keyframes floatUp{
  0%{ transform: translateY(20px) scale(.9); opacity:0; }
  12%{ opacity:.75; }
  100%{ transform: translateY(-120vh) scale(1.15); opacity:0; }
}

/* thanks + envelope */
.thanks-wrap{
  display:flex;
  flex-direction:column;
  align-items:center;
  gap: 14px;
  margin-top: 10px;
  position: relative;
  z-index: 3;
}
.thanks-text{
  font-weight:700;
  font-size: 16px;
  opacity:0;
  transform: translateY(8px);
  transition: opacity .5s ease, transform .5s ease;
}
.thanks-text.show{ opacity:1; transform: translateY(0); }

.envelope{
  border:0;
  background: transparent;
  cursor:pointer;
  padding: 0;
  position:relative;
  width: min(420px, 86vw);
  height: 270px;
  display:flex;
  align-items:center;
  justify-content:center;
  opacity:0;
  transform: translateY(10px) scale(.98);
  transition: opacity .6s ease, transform .6s ease;
  margin-bottom: 10px; /* keeps it from overlapping restart */
  z-index: 3;
}
.envelope.show{ opacity:1; transform: translateY(0) scale(1); }

.env{ position:relative; width: min(360px, 80vw); height: 220px; border-radius: 20px; }
.env__back{
  position:absolute; inset:0;
  border-radius: 20px;
  background: rgba(255,255,255,.10);
  border: 1px solid rgba(255,255,255,.16);
  box-shadow: var(--softShadow);
}
.env__front{
  position:absolute; left:0; right:0; bottom:0;
  height: 55%;
  border-radius: 0 0 20px 20px;
  background: rgba(255,79,184,.14);
  border-top: 1px solid rgba(255,255,255,.12);
}
.env__flap{
  position:absolute; left:0; right:0; top:0;
  height: 60%;
  border-radius: 20px 20px 10px 10px;
  background: rgba(255,255,255,.10);
  border: 1px solid rgba(255,255,255,.12);
  transform-origin: top center;
  transform: rotateX(0deg);
  transition: transform .7s cubic-bezier(.2,.9,.2,1);
}
.env__heart{
  position:absolute; left:50%; top: 52%;
  transform: translate(-50%, -50%);
  font-size: 28px;
  filter: drop-shadow(0 0 18px rgba(255,79,184,.35));
}
.env__hint{
  position:absolute; left:50%; bottom: 16px;
  transform: translateX(-50%);
  font-size: 12px;
  font-weight:800;
  letter-spacing:.3px;
  color: rgba(255,255,255,.85);
  opacity:0;
  animation: blink 1.1s ease-in-out infinite;
}
.env__hint.show{ opacity:1; }
@keyframes blink{ 0%,100%{ opacity:.15; } 50%{ opacity:1; } }

.letter{
  position:absolute;
  width: min(340px, 76vw);
  height: 210px;
  top: 14px;
  left:50%;
  transform: translateX(-50%) translateY(50px);
  opacity:0;
  pointer-events:none;
  transition: transform .7s cubic-bezier(.2,.9,.2,1), opacity .5s ease;
  z-index: 4;
}
.letter__paper{
  width:100%; height:100%;
  border-radius: 18px;
  background: rgba(255,255,255,.92);
  color:#14141a;
  border: 1px solid rgba(0,0,0,.12);
  box-shadow: 0 18px 40px rgba(0,0,0,.28);
  padding: 14px 14px 12px;
  overflow:auto;
}
.letter__title{ font-weight:900; font-size: 18px; margin-bottom: 8px; }
.letter__body{ text-align:left; font-size: 13px; line-height: 1.45; white-space: pre-wrap; }

.envelope.open .env__flap{ transform: rotateX(160deg); }
.envelope.open .letter{
  opacity:1;
  transform: translateX(-50%) translateY(-18px);
  pointer-events:auto;
}

/* Restart must ALWAYS be clickable */
.house-actions{
  margin-top: 10px;
  display:flex;
  justify-content:center;
  position: relative;
  z-index: 10;
  pointer-events: auto;
}

@media (max-width: 520px){
  .hud__pill{ font-size:12px; }
  .footer-note{ display:none; }
}

@media (prefers-reduced-motion: reduce){
  *{ animation:none !important; transition:none !important; }
}
